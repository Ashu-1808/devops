# install minikube
# minikube addons enable ingress
# kubectl get ns
# kubectl get pods -n ingress-nginx
# kubectl create deployment web --image=gcr.io/google-samples/hello-app:1.0

# Verify that the Deployment is in a Ready state:
# kubectl get deployment web 

# Expose the Deployment:
# kubectl expose deployment web --type=NodePort --port=8080

# Verify the Service is created and is available on a node port:
# kubectl get service web
# minikube service web --url
# curl http://172.17.0.15:31634

# kubectl create deployment web2 --image=gcr.io/google-samples/hello-app:2.0

# Verify that the Deployment is in a Ready state:
# kubectl get deployment web2 

# Expose the second Deployment:
# kubectl expose deployment web2 --port=8080 --type=NodePort

# kubectl get svc

# vim ingress.yaml
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: example-ingress
spec:
  ingressClassName: nginx
  rules: 
    - host: hello-world.example
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: web
                port:
                  number: 8080
          - path: /v2
            pathType: Prefix
            backend:
              service:
                name: web2
                port:
                  number: 8080        
---
# kubectl apply -f ingress.yaml

# Access the 1st version of the Hello World app
# curl --resolve "hello-world.example:80:$( minikube ip )" -i http://hello-world.example
# Access the 2nd version of the Hello World app
# curl --resolve "hello-world.example:80:$( minikube ip )" -i http://hello-world.example/v2

